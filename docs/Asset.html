<!DOCTYPE html>

<html>
<head>
  <title>Asset.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="Album.html">
                Album.js
              </a>
            
              
              <a class="source" href="Asset.html">
                Asset.js
              </a>
            
              
              <a class="source" href="Heart.html">
                Heart.js
              </a>
            
              
              <a class="source" href="Resource.html">
                Resource.js
              </a>
            
              
              <a class="source" href="chute.html">
                chute.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>Asset.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="string">'use strict'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1>Chute.API.Asset</h1>
<p>Asset represents metadata about an image or a video.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>angular.module(<span class="string">'chute'</span>).factory(<span class="string">'Chute.API.Asset'</span>,
  [<span class="string">'Chute.API.Resource'</span>, <span class="string">'$http'</span>, <span class="string">'apiUrl'</span>, <span class="string">'Chute.API.Heart'</span>, <span class="keyword">function</span>(Resource, $http, apiUrl, Heart) {

  <span class="keyword">var</span> AssetResource = Resource(apiUrl + <span class="string">'/albums/:album/assets/:collectionRoute:id/:memberRoute'</span>, {
    album: <span class="string">'@album'</span>,
    id: <span class="string">'@id'</span>,
    collectionRoute: <span class="string">'@collectionRoute'</span>,
    memberRoute: <span class="string">'@memberRoute'</span>
  }, {
    <span class="comment">/* custom resource methods */</span>

    query: {method: <span class="string">'GET'</span>, isArray: <span class="literal">false</span>}
  });


  <span class="keyword">var</span> PER_PAGE = <span class="number">5</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p><a name="Assets"></a></p>
<h2>Assets Collection</h2>
<p>Collection of assets returned by <a href="#query">Asset.query</a>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  AssetResource.Collection = {</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h3>Assets.prevPage</h3>
<p>Fetch previous page of assets and prepend them to current instance of assets.</p>
<p>When the assets are sorted naturally (<code>sort</code> param is &#39;id&#39;, &#39;time&#39; or none), continuous paging is used. Otherwise uses standard paging (using <code>page</code> param).</p>
<p><strong>@params</strong></p>
<ul>
<li><code>success</code> {function} - will be passed these arguments:<ul>
<li>{array} detached set of newly fetched assets (in case you need them)</li>
<li>{object} response headers</li>
</ul>
</li>
<li><code>error</code> {function}</li>
</ul>
<p><strong>@example</strong></p>
<pre><code class="lang-js">var assets = Asset.query({album: &#39;abcqsrlx&#39;, page: 10});
assets.prevPage();</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>    prevPage: <span class="keyword">function</span>(success, error) {
      <span class="keyword">this</span>.params.page--;

      <span class="keyword">var</span> params = angular.copy(<span class="keyword">this</span>.params);

      <span class="keyword">if</span> (!<span class="keyword">this</span>.params.sort || <span class="keyword">this</span>.params.sort === <span class="string">'id'</span> || <span class="keyword">this</span>.params.sort === <span class="string">'time'</span>) {
        params.since_id = <span class="keyword">this</span>[<span class="number">0</span>].chute_asset_id;
        <span class="keyword">delete</span> params.page;  <span class="comment">// don't send the page param</span>
      } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.params.page &lt;= <span class="number">0</span>) {
        <span class="keyword">throw</span> <span class="keyword">new</span> RangeError(<span class="string">"Cannot fetch previous page with index "</span> + <span class="keyword">this</span>.params.page + <span class="string">"."</span>);
      }
      
      <span class="keyword">var</span> assets = <span class="keyword">this</span>;
      AssetResource._query(params, <span class="keyword">function</span>(response) {
        <span class="keyword">var</span> newAssets = angular.extend([], {params: angular.copy(assets.params)}, AssetResource.Collection);
        <span class="keyword">if</span> (response &amp;&amp; response.data) {
          angular.forEach(response.data, <span class="keyword">function</span>(data) {
            data.album = params.album;
            <span class="keyword">var</span> asset = <span class="keyword">new</span> AssetResource(data);
            newAssets.push(asset);
          });
          <span class="comment">/* prepend new assets to the original array */</span>
          assets.unshift.apply(assets, newAssets);
        }
        (success||angular.noop)(newAssets, response.headers);
      }, error);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h3>Assets.nextPage</h3>
<p>Fetch next page of assets and append them to current instance of assets.</p>
<p>When the assets are sorted naturally (<code>sort</code> param is &#39;id&#39;, &#39;time&#39; or none), continuous paging is used. Otherwise uses standard paging (using <code>page</code> param).</p>
<p><strong>@params</strong></p>
<ul>
<li><code>success</code> {function} - will be passed these arguments:<ul>
<li>{array} detached set of newly fetched assets (in case you need them)</li>
<li>{object} response headers</li>
</ul>
</li>
<li><code>error</code> {function}</li>
</ul>
<p><strong>@example</strong></p>
<pre><code class="lang-js">var assets = Asset.query({album: &#39;abcqsrlx&#39;});
assets.nextPage();</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>    nextPage: <span class="keyword">function</span>(success, error) {
      <span class="keyword">this</span>.params.page++;

      <span class="keyword">var</span> params = angular.copy(<span class="keyword">this</span>.params);

      <span class="keyword">if</span> (!<span class="keyword">this</span>.params.sort || <span class="keyword">this</span>.params.sort === <span class="string">'id'</span> || <span class="keyword">this</span>.params.sort === <span class="string">'time'</span>) {
        params.max_id = <span class="keyword">this</span>[<span class="keyword">this</span>.length-<span class="number">1</span>].chute_asset_id;
        <span class="keyword">delete</span> params.page;  <span class="comment">// don't send the page param</span>
      }

      <span class="keyword">var</span> assets = <span class="keyword">this</span>;
      AssetResource._query(params, <span class="keyword">function</span>(response) {
        <span class="keyword">var</span> newAssets = angular.extend([], {params: angular.copy(assets.params)}, AssetResource.Collection);
        <span class="keyword">if</span> (response &amp;&amp; response.data) {
          angular.forEach(response.data, <span class="keyword">function</span>(data) {
            data.album = params.album;
            <span class="keyword">var</span> asset = <span class="keyword">new</span> AssetResource(data);
            newAssets.push(asset);
          });
          <span class="comment">/* append new asssets to the original array */</span>
          assets.push.apply(assets, newAssets);
        }
        <span class="keyword">if</span> (!response || !response.data || response.data.length != (params.per_page || PER_PAGE)) {
          assets._hasMore = <span class="literal">false</span>;
        }
        (success||angular.noop)(newAssets, response.headers);
      }, error);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h3>Assets.hasMore</h3>
<p>Check if there are more assets available.</p>
<p>This method doesn&#39;t trigger any external request. The resolution is based on the result of the last query (if it returned less than requested number of items, it&#39;s a signal there are no more available).</p>
<p><strong>@returns</strong> {boolean}</p>
<ul>
<li>true if there are more assets on the server;</li>
<li>false if we have reached the end</li>
</ul>
<p><strong>@example</strong></p>
<pre><code class="lang-js">var assets = Asset.query({album: &#39;abcqsrlx&#39;});
if (assets.hasMore()) {
  assets.nextPage();
}</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>    hasMore: <span class="keyword">function</span>() {
      <span class="keyword">return</span> !! <span class="keyword">this</span>._hasMore;
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p><a name="query"></a></p>
<h2>Asset.query</h2>
<p>Fetch album assets. Overwrites default <a href="Resource.html#query">Resource.query</a> method.</p>
<p><strong>@params</strong></p>
<ul>
<li><code>params</code> {object}<ul>
<li><code>album</code> or <code>album_id</code> or <code>album_shortcut</code> {string} - album shortcut like <em>abcqsrlx</em></li>
<li><code>perPage</code> {number} - assets to return per page</li>
<li>and more... see Chute API docs</li>
</ul>
</li>
<li><code>success</code> {function}</li>
<li><code>error</code> {function}</li>
</ul>
<p><strong>@return</strong> {array} <a href="#Assets">Assets</a>. Has additional functions (see above):</p>
<ul>
<li><code>nextPage</code> - fetch next page using same params as for query</li>
<li><code>prevPage</code> - fetch previous page using same params as for query</li>
<li><code>hasMore</code> - whether next page of assets is available</li>
</ul>
<p>See <a href="http://docs.angularjs.org/api/ngResource.$resource">AngularJS docs</a> for more information.</p>
<p><strong>@example</strong></p>
<pre><code class="lang-js">$scope.assets = Asset.query({album: &#39;abcqsrlx&#39;});</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>  AssetResource.__query = AssetResource.query;
  AssetResource.query = <span class="keyword">function</span>(params, success, error) {
    <span class="keyword">if</span> (params.album_id) {
      params.album = params.album || params.album_id;
      <span class="keyword">delete</span> params.album_id;
    }
    <span class="keyword">if</span> (params.album_shortcut) {
      params.album = params.album || params.album_shortcut;
      <span class="keyword">delete</span> params.album_shortcut;
    }

    <span class="keyword">return</span> AssetResource.__query(params, <span class="keyword">function</span>(assets, responseHeaders) {
      angular.forEach(assets, <span class="keyword">function</span>(asset) {
        asset.album = params.album;
      });
      (success||angular.noop)(assets, responseHeaders);
    }, error);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><a name="get"></a></p>
<h2>Asset.get</h2>
<p>Fetch asset from an album. Extends <a href="Resource.html#get">Resource.get</a> method.</p>
<p>See <a href="http://docs.angularjs.org/api/ngResource.$resource">AngularJS docs</a> for more information.</p>
<p><strong>@params</strong></p>
<ul>
<li><code>params</code> {object}<ul>
<li><code>album</code> or <code>album_id</code> or <code>album_shortcut</code> {string} - album shortcut</li>
<li><code>id</code> or <code>shortcut</code> or <code>asset</code> {string} - asset shortcut</li>
</ul>
</li>
<li><code>success</code> {function}</li>
<li><code>error</code> {function}</li>
</ul>
<p><strong>@return</strong> {object} resource object that will be eventually filled with asset data</p>
<p><strong>@example</strong></p>
<pre><code class="lang-js">var asset = Asset.get({album: &#39;abcqsrlx&#39;, asset: &#39;vjp3miwob&#39;});</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>  AssetResource.__get = AssetResource.get;
  AssetResource.get = <span class="keyword">function</span>(params, success, error) {
    <span class="keyword">if</span> (params.album_id) {
      params.album = params.album || params.album_id;
      <span class="keyword">delete</span> params.album_id;
    }
    <span class="keyword">if</span> (params.album_shortcut) {
      params.album = params.album || params.album_shortcut;
      <span class="keyword">delete</span> params.album_shortcut;
    }
    <span class="keyword">if</span> (params.asset) {
      params.id = params.id || params.asset;
      <span class="keyword">delete</span> params.asset;
    }
    <span class="keyword">if</span> (params.shortcut) {
      params.id = params.id || params.shortcut;
      <span class="keyword">delete</span> params.shortcut;
    }

    <span class="keyword">return</span> AssetResource.__get(params, success, error);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p><a name="heart"></a></p>
<h2>asset.heart</h2>
<p>Heart an asset.</p>
<p><strong>@params</strong></p>
<ul>
<li><code>options</code> {object} - specify success and error callbacks</li>
</ul>
<p><strong>@example</strong></p>
<pre><code class="lang-javascript">asset.heart({
  // Success callback
  &#39;success&#39;: function(){
    // asset hearted
  },
  // Error callback
  &#39;error&#39;: function(){
    // error happened during request
  }
);</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>  AssetResource.prototype.heart = <span class="keyword">function</span>(options) {
    options = (options || {});
      
    <span class="keyword">var</span> key = <span class="keyword">this</span>.album + <span class="string">'-'</span> + <span class="keyword">this</span>.shortcut + <span class="string">'-heart'</span>;
    <span class="keyword">var</span> identifier = window.localStorage[key];
    <span class="keyword">if</span> (identifier) {
      (options.error || angular.noop)();
      <span class="keyword">return</span> <span class="literal">false</span>;
    }

    <span class="keyword">var</span> self = <span class="keyword">this</span>;

    $http.post(apiUrl + <span class="string">'/albums/'</span> + <span class="keyword">this</span>.album + <span class="string">'/assets/'</span> + <span class="keyword">this</span>.shortcut + <span class="string">'/hearts'</span>)
    .success(<span class="keyword">function</span>(response) {
      <span class="keyword">var</span> heart = <span class="keyword">new</span> Heart(response.data);
      window.localStorage[key] = heart.identifier;
      self.hearts = (parseInt(self.hearts) || <span class="number">0</span>) + <span class="number">1</span>;
      (options.success || angular.noop)(heart);
    }).error(options.error || angular.noop);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h2>Asset.unheart</h2>
<p>Unheart an asset.</p>
<p><strong>@params</strong></p>
<ul>
<li><code>options</code> {object} - specify success and error callbacks</li>
</ul>
<p><strong>@example</strong></p>
<pre><code class="lang-js">asset.unheart({
  // Success callback
  &#39;success&#39;: function(){
    // asset hearted
  },
  // Error callback
  &#39;error&#39;: function(){
    // error happened during request
  }
);</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>  AssetResource.prototype.unheart = <span class="keyword">function</span>(options) {
    options = (options || {});

    <span class="keyword">var</span> key = <span class="keyword">this</span>.album + <span class="string">'-'</span> + <span class="keyword">this</span>.shortcut + <span class="string">'-heart'</span>;
    <span class="keyword">var</span> identifier = window.localStorage[key];
    <span class="keyword">if</span> (! identifier) {
      (options.error || angular.noop)();
      <span class="keyword">return</span> <span class="literal">false</span>;
    }

    <span class="keyword">var</span> self = <span class="keyword">this</span>;

    <span class="keyword">new</span> Heart({identifier: identifier}).$remove({}, <span class="keyword">function</span>(response) {
      <span class="keyword">delete</span> window.localStorage[key];
      self.hearts = (parseInt(self.hearts) || <span class="number">0</span>) - <span class="number">1</span>;
      (options.success || angular.noop)(response.data);
    }, options.error || angular.noop);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h2>Asset.hearted</h2>
<p>Check if asset was already hearted before.</p>
<p><strong>@return</strong> {boolean}</p>
<p><strong>@example</strong></p>
<pre><code class="lang-js">var isHearted = asset.hearted();</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>  AssetResource.prototype.hearted = <span class="keyword">function</span>() {
    <span class="keyword">return</span> !!window.localStorage[<span class="keyword">this</span>.album + <span class="string">'-'</span> + <span class="keyword">this</span>.shortcut + <span class="string">'-heart'</span>];
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h2>Asset.toggleHeart</h2>
<p>Heart if hearted, unheart if not hearted.</p>
<p><strong>@params</strong></p>
<ul>
<li><code>options</code> {object} - specify success and error callbacks</li>
</ul>
<p><strong>@example</strong></p>
<pre><code class="lang-js">asset.toggleHeart({
  // Success callback
  &#39;success&#39;: function(){
    // asset hearted
  },
  // Error callback
  &#39;error&#39;: function(){
    // error happened during request
  }
});</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>  AssetResource.prototype.toggleHeart = <span class="keyword">function</span>(options) {
    <span class="keyword">if</span> (<span class="keyword">this</span>.hearted()) {
      <span class="keyword">this</span>.unheart(options);
    } <span class="keyword">else</span> {
      <span class="keyword">this</span>.heart(options);
    }
  }

  <span class="keyword">return</span> AssetResource;
}]);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
