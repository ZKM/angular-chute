<!DOCTYPE html>

<html>
<head>
  <title>Resource.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="Album.html">
                Album.js
              </a>
            
              
              <a class="source" href="Asset.html">
                Asset.js
              </a>
            
              
              <a class="source" href="Heart.html">
                Heart.js
              </a>
            
              
              <a class="source" href="Resource.html">
                Resource.js
              </a>
            
              
              <a class="source" href="chute.html">
                chute.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>Resource.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="string">'use strict'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1>Chute.API.Resouce</h1>
<p>Abstract class that provides common behavior for Chute API resources and serializing data.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>angular.module(<span class="string">'chute'</span>).factory(<span class="string">'Chute.API.Resource'</span>,
  [<span class="string">'$resource'</span>, <span class="string">'$http'</span>, <span class="keyword">function</span>($resource, $http) {

  <span class="keyword">var</span> ResourceFactory = <span class="keyword">function</span>(url, paramDefaults, actions) {
    url = url || <span class="string">''</span>;
    paramDefaults = paramDefaults || {};
    actions = angular.extend(actions || {}, {query: {method: <span class="string">'GET'</span>, isArray: <span class="literal">false</span>}});

    <span class="keyword">var</span> Resource = $resource(url, paramDefaults, actions);

    <span class="keyword">var</span> PER_PAGE = <span class="number">5</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p><a name="Collection"></a></p>
<h2>Collection</h2>
<p>Collection of resources returned by <code>Resource.query</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Resource.Collection = {</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h3>Collection.prevPage</h3>
<p>Fetch previous page of collection and prepend them to current instance of collection.</p>
<p>When the collection are sorted naturally (<code>sort</code> param is &#39;id&#39;, &#39;time&#39; or none), continuous paging is used. Otherwise uses standard paging (using <code>page</code> param).</p>
<p><strong>@params</strong></p>
<ul>
<li><code>success</code> {function} - will be passed these arguments:<ul>
<li>{array} detached set of newly fetched collection (in case you need them)</li>
<li>{object} response headers</li>
</ul>
</li>
<li><code>error</code> {function}</li>
</ul>
<p><strong>@example</strong></p>
<pre><code class="lang-js">var collection = Asset.query({album: &#39;abcqsrlx&#39;, page: 10});
collection.prevPage();</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>      prevPage: <span class="keyword">function</span>(success, error) {
        <span class="keyword">this</span>.params.page--;

        <span class="keyword">var</span> params = angular.copy(<span class="keyword">this</span>.params);

        <span class="keyword">if</span> (<span class="keyword">this</span>.params.page &lt;= <span class="number">0</span>) {
          <span class="keyword">throw</span> <span class="keyword">new</span> RangeError(<span class="string">"Cannot fetch previous page with index "</span> + <span class="keyword">this</span>.params.page + <span class="string">"."</span>);
        }
        
        <span class="keyword">var</span> collection = <span class="keyword">this</span>;
        Resource._query(params, <span class="keyword">function</span>(response) {
          <span class="keyword">var</span> newCollection = angular.extend([], {params: angular.copy(collection.params)}, Resource.Collection);
          <span class="keyword">if</span> (response &amp;&amp; response.data) {
            angular.forEach(response.data, <span class="keyword">function</span>(data) {
              newCollection.push(<span class="keyword">new</span> Resource(data));
            });
            <span class="comment">/* prepend new collection to the original array */</span>
            collection.unshift.apply(collection, newCollection);
          }
          (success||angular.noop)(newCollection, response.headers);
        }, error);
      },</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h3>Collection.nextPage</h3>
<p>Fetch next page of collection and append resources to current instance of collection.</p>
<p><strong>@params</strong></p>
<ul>
<li><code>success</code> {function} - will be passed these arguments:<ul>
<li>{array} detached set of newly fetched resources (in case you need them)</li>
<li>{object} response headers</li>
</ul>
</li>
<li><code>error</code> {function}</li>
</ul>
<p><strong>@example</strong></p>
<pre><code class="lang-js">var assets = Asset.query({album: &#39;abcqsrlx&#39;});
assets.nextPage();</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>      nextPage: <span class="keyword">function</span>(success, error) {
        <span class="keyword">this</span>.params.page++;

        <span class="keyword">var</span> params = angular.copy(<span class="keyword">this</span>.params);

        <span class="keyword">var</span> collection = <span class="keyword">this</span>;
        Resource._query(params, <span class="keyword">function</span>(response) {
          <span class="keyword">var</span> newCollection = angular.extend([], {params: angular.copy(collection.params)}, Resource.Collection);
          <span class="keyword">if</span> (response &amp;&amp; response.data) {
            angular.forEach(response.data, <span class="keyword">function</span>(data) {
              newCollection.push(<span class="keyword">new</span> Resource(data));
            });
            <span class="comment">/* append new asssets to the original array */</span>
            collection.push.apply(collection, newCollection);
          }
          <span class="keyword">if</span> (!response || !response.data || response.data.length != (params.per_page || PER_PAGE)) {
            collection._hasMore = <span class="literal">false</span>;
          }
          (success||angular.noop)(newCollection, response.headers);
        }, error);
      },</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h3>Collection.hasMore</h3>
<p>Check if there are more resources available.</p>
<p>This method doesn&#39;t trigger any external request. The resolution is based on the result of the last query (if it returned less than requested number of items, it&#39;s a signal there are no more available).</p>
<p><strong>@returns</strong> {boolean}</p>
<ul>
<li>true if there are more resources on the server;</li>
<li>false if we have reached the end</li>
</ul>
<p><strong>@example</strong></p>
<pre><code class="lang-js">var collection = Asset.query({album: &#39;abcqsrlx&#39;});
if (collection.hasMore()) {
  collection.nextPage();
}</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>      hasMore: <span class="keyword">function</span>() {
        <span class="keyword">return</span> !! <span class="keyword">this</span>._hasMore;
      }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p><a name="query"></a></p>
<h2>Resource.query</h2>
<p>Fetch resource collection. Overwrites default <code>$resource.query</code> method, maintaining the same API.</p>
<p>See <a href="http://docs.angularjs.org/api/ngResource.$resource">$resource docs</a> for more information.</p>
<p><strong>@params</strong></p>
<ul>
<li><code>params</code> {object} - see <a href="http://www.getchute.com/developers/reference/chute-api/v2/">Chute API docs</a> for query params</li>
<li><code>success</code> {function}</li>
<li><code>error</code> {function}</li>
</ul>
<p><strong>@return</strong> {array} <a href="#Collection">Collection</a>. Has additional functions (see above):</p>
<ul>
<li><code>nextPage</code> - fetch next page using same params as for query</li>
<li><code>prevPage</code> - fetch previous page using same params as for query</li>
<li><code>hasMore</code> - whether next page of collection is available</li>
</ul>
<p><strong>@example</strong></p>
<pre><code class="lang-js">$scope.assets = Asset.query({album: &#39;abcqsrlx&#39;});</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Resource._query = Resource.query;
    Resource.query = <span class="keyword">function</span>(params, success, error) {
      params = params || {};

      <span class="keyword">if</span> (params.perPage) {
        params.per_page = params.perPage;
        <span class="keyword">delete</span> params.perPage;
      }

      <span class="keyword">var</span> saveParams = angular.extend({page: <span class="number">1</span>}, params);
      <span class="comment">/* this is a nice trick to get array with helper functions */</span>
      <span class="keyword">var</span> collection = angular.extend([], {params: saveParams}, Resource.Collection);

      Resource._query(params, <span class="keyword">function</span>(response) {
        <span class="keyword">if</span> (response &amp;&amp; response.data) {
          collection.length = <span class="number">0</span>;
          angular.forEach(response.data, <span class="keyword">function</span>(data) {
            collection.push(<span class="keyword">new</span> Resource(data));
          });

          <span class="keyword">if</span> (response.data.length &lt; (params.per_page || PER_PAGE) || !response.pagination || !response.pagination.next_page) {
            collection._hasMore = <span class="literal">false</span>;
          } <span class="keyword">else</span> {
            collection._hasMore = <span class="literal">true</span>;
          }
        }
        (success||angular.noop)(collection, response.headers);
      }, error);

      <span class="keyword">return</span> collection;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><a name="get"></a></p>
<h2>Resource.get</h2>
<p>Fetch resource. Overwrites default <code>$resource.get</code> method, maintaining the same API.</p>
<p>See <a href="http://docs.angularjs.org/api/ngResource.$resource">$resource docs</a> for more information.</p>
<p><strong>@params</strong></p>
<ul>
<li><code>params</code> {object} - see <a href="http://www.getchute.com/developers/reference/chute-api/v2/">Chute API docs</a></li>
<li><code>success</code> {function}</li>
<li><code>error</code> {function}</li>
</ul>
<p><strong>@return</strong> {object} resource object that will be eventually filled with data</p>
<p><strong>@example</strong></p>
<pre><code class="lang-js">var asset = Asset.get({album: &#39;abcqsrlx&#39;, asset: &#39;vjp3miwob&#39;});</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Resource._get = Resource.get;
    Resource.get = <span class="keyword">function</span>(params, success, error) {
      success = (success || angular.noop);
      error   = (error   || angular.noop);

      <span class="keyword">var</span> data = {};

      <span class="keyword">var</span> resource = <span class="keyword">this</span> <span class="keyword">instanceof</span> Resource ? <span class="keyword">this</span> : <span class="keyword">new</span> Resource(data);

      Resource._get(params, <span class="keyword">function</span>(response) {
        angular.copy(response.data, resource);
        success(response.data, response.headers);
      }, error);

      <span class="keyword">return</span> resource;
    };  

    <span class="keyword">return</span> Resource;
  };

  <span class="keyword">return</span> ResourceFactory;
}]);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
